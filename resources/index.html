<!doctype html>
<html class="no-js"
      lang="">
    <head>
        <script src="/dependencies.js"></script>
        <script src="/simulation.js"></script>

        <title>FliebertJS</title>
    </head>
    <body>
        <script src="http://mobs.dev:35729/livereload.js?snipver=1"></script>

        <canvas id="world"
                width="500"
                height="500"
                style="border: 1px solid black;"></canvas>

        <script>
            const buffer = new Buffer(firebaseConfig);

            const renderer = new Renderer('#world', buffer);
        </script>
        <div>Showing: <strong id="currentTick">0</strong> / <strong id="bufferSize">0</strong></div>
        <div><strong id="serverStatus">Connecting..</strong></div>

        <script>
            const bufferDisplay = document.getElementById('bufferSize');
            const tickDisplay = document.getElementById('currentTick');
            const statusDisplay = document.getElementById('serverStatus');

            buffer.onStatusChange(function (status) {
                console.log(status);
                statusDisplay.innerText = status.text;
                bufferDisplay.innerText = buffer.getLastTick();
            });

            renderer.onDraw(function (tick) {
                tickDisplay.innerText = tick;
            });

            renderer.el.onmousedown = function (e) {
                buffer.sendCommand('attract', {x: e.offsetX, y: e.offsetY});
            };

            function play() {
                renderer.play();
            }
            function pause() {
                renderer.stop();
            }
            function stop() {
                renderer.stop();
                renderer.setCurrentFrame(0);
                renderer.clearScene();
            }
            function reset() {
                renderer.stop();
                renderer.setCurrentFrame(0);
                renderer.clearScene();
                buffer.sendCommand('clear');
                renderer.getBuffer().clear();
            }
            function firstFrame() {
                renderer.stop();
                renderer.setCurrentFrame(0);
                renderer.draw();
            }
            function lastFrame() {
                renderer.stop();
                renderer.setCurrentFrame(
                        buffer.getLastTick() *
                        renderer.getTickRate()
                );
                renderer.draw();
            }
            function nextFrame() {
                renderer.stop();
                renderer.setCurrentFrame(
                        (renderer.getVisibleTick() + 1) *
                        renderer.getTickRate()
                );
                renderer.draw();
            }
            function previousFrame() {
                renderer.stop();
                renderer.setCurrentFrame(
                        (renderer.getVisibleTick() - 1) *
                        renderer.getTickRate()
                );
                renderer.draw();
            }
            //            function startLiveMode() {
            //            }
            //            function stopLiveMode() {
            //            }
        </script>


        <div>
            <button onclick="buffer.sendCommand('simulate', {amount: 10})">Simulate 10</button>
            <button onclick="buffer.sendCommand('simulate', {amount: 100})">Simulate 100</button>
            <button onclick="buffer.sendCommand('simulate', {amount: 1000})">Simulate 1000</button>

            <button onclick="buffer.sendCommand('simulate', {amount: false})">Continuous</button>
            <button onclick="buffer.sendCommand('stop')">Stop</button>
        </div>

        <div>
            <button onclick="firstFrame()">|<<</button>
            <button onclick="previousFrame()"><</button>
            <button onclick="play()">play</button>
            <button onclick="pause()">pause</button>
            <button onclick="stop()">stop</button>
            <button onclick="nextFrame()">></button>
            <button onclick="lastFrame()">>>|</button>

            <button onclick="reset()">Reset</button>
        </div>
    </body>
</html>